<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test de Arquetipos de Liderazgo — Escolar (Versión Definitiva)</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2canvas + jsPDF para generar PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  /* ---------- PÁRAMO: paleta limpia, acento verde/amarillo/terroso ---------- */
  :root{
    --bg: #f6f8f7;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #8aa68a; /* verde páramo */
    --fraile: #d9bf57; /* amarillo frailejón */
    --oso: #8b6a4a; /* marrón terroso */
    --condor: #4a6fb1; /* azul cóndor */
    --line: #e7e9eb;
    --text: #0f172a;
    --glass: rgba(255,255,255,0.85);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;background:linear-gradient(180deg,#fbfdfc 0%, #f6f8f7 100%)}
  body{
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--text);
    padding:28px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .wrap{
    max-width:1000px;margin:0 auto;background:var(--card);border-radius:16px;padding:26px;border:1px solid var(--line);
    box-shadow:0 12px 40px rgba(15,23,42,0.06);
  }

  header{display:flex;gap:18px;align-items:center}
  .logo{
    width:74px;height:74px;border-radius:14px;background:linear-gradient(180deg,var(--accent),#b7d4b2);
    display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;font-size:20px;
    box-shadow:0 6px 18px rgba(138,166,138,0.14);
  }
  h1{margin:0;font-size:22px;line-height:1.05}
  p.lead{margin:6px 0 18px;color:var(--muted);line-height:1.45}
  .meta{display:flex;gap:12px;align-items:center;margin-bottom:8px}

  .progress{height:14px;background:#f2f6f2;border-radius:999px;overflow:hidden;margin:18px 0;border:1px solid var(--line)}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#cfe6cf);width:0%;transition:width .25s ease}

  #quiz{margin-top:8px}
  .page{display:none}
  .page.active{display:block}

  .question{
    border:1px solid var(--line);background:linear-gradient(180deg,#ffffff,#fbfefb);border-radius:12px;padding:14px;margin-bottom:14px;
    box-shadow:0 6px 20px rgba(12,18,12,0.02);
  }
  .question h4{margin:0 0 10px;font-size:15.5px}
  .opts{display:flex;flex-direction:column;gap:10px;margin-top:6px}

  /* option styling */
  label.opt{
    display:flex;gap:14px;align-items:flex-start;padding:12px;border-radius:10px;background:var(--glass);border:1px solid #f1f4f1;cursor:pointer;
    transition:transform .12s, box-shadow .12s, border-color .12s;user-select:none;
  }
  label.opt:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(12,22,14,0.05)}
  label.opt input[type="radio"]{margin-top:3px;transform:scale(1.1)}
  label.opt .pill{
    min-width:38px;padding:8px;border-radius:8px;color:#fff;font-weight:800;text-align:center;
    font-size:13px;line-height:1;
  }
  .pill.buho{background:var(--accent)}
  .pill.fraile{background:var(--fraile)}
  .pill.oso{background:var(--oso)}
  .pill.condor{background:var(--condor)}

  /* selected visual */
  label.opt.selected{
    border-color:rgba(0,0,0,0.06);
    box-shadow:0 10px 28px rgba(0,0,0,0.06);
    transform:translateY(-2px);
    background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,255,250,0.95));
  }

  .nav{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:18px}
  .nav .info{color:var(--muted);font-size:14px}
  .controls{display:flex;gap:10px}

  button.primary{
    background:linear-gradient(180deg,var(--accent),#699a6a);color:#083012;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:800;
    box-shadow:0 12px 30px rgba(86,129,86,0.12);font-size:15px;
  }
  button.ghost{
    background:#fff;color:var(--text);border:1px solid var(--line);padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:700;
  }
  button.ghost[disabled]{opacity:.5;cursor:not-allowed}

  #result{display:none;margin-top:18px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .profileCard{background:linear-gradient(180deg,#ffffff,#fbfefb);border-radius:12px;padding:16px;border:1px solid var(--line)}
  .dominantTitle{font-family:"Georgia","Times New Roman",serif;font-size:36px;color:var(--text);margin:4px 0}
  .dominantSubtitle{font-size:14px;color:var(--muted);margin-bottom:8px}
  .dominantBadge{display:inline-block;padding:10px 14px;border-radius:999px;font-weight:900;color:#fff}
  .small{font-size:13px;color:var(--muted)}
  footer.small{margin-top:16px;color:var(--muted);font-size:13px}

  /* responsive */
  @media(max-width:900px){
    .grid2{grid-template-columns:1fr}
    .logo{width:58px;height:58px}
    .dominantTitle{font-size:28px}
  }

  /* PDF-friendly hidden helper */
  .printHidden{display:none}
</style>
</head>
<body>
  <div class="wrap" id="appWrap">
    <header>
      <div class="logo">TN</div>
      <div>
        <h1>Test de Arquetipos de Liderazgo — Escolar</h1>
        <p class="lead">Responde con la acción que <strong>realmente</strong> harías — no lo que suena mejor. Son 40 situaciones: 10 por arquetipo. Las preguntas aparecen en orden aleatorio (10 por página).</p>
        <div class="meta"><span class="small">Diseño inspirado en los páramos — tonos verdes, terrosos y azules.</span></div>
      </div>
    </header>

    <div class="progress" aria-hidden="true"><i id="progressBar" style="width:0%"></i></div>

    <div id="quiz" role="list"></div>

    <div class="nav" aria-hidden="false">
      <div class="info" id="pageInfo">Página 1 / 4 · Respondidas 0 / 40</div>
      <div class="controls">
        <button id="prevBtn" class="ghost" onclick="prevPage()" disabled>Anterior</button>
        <button id="nextBtn" class="primary" onclick="nextPage()">Siguiente</button>
      </div>
    </div>

    <div id="result" aria-live="polite"></div>

    <footer class="small">Sustento: Greenleaf, Goleman y teorías contemporáneas sobre liderazgo situacional y emocional — adaptado para contexto escolar.</footer>
  </div>

<script>
/* =========================
   PREGUNTAS (40) — objetos (según tus 40 nuevas preguntas)
   A = Búho (buho), B = Frailejón (frailejon), C = Oso (oso), D = Cóndor (condor)
   ========================= */
const QUESTIONS = [
/* 1 */ {q:"En una caminata, un compañero empieza a quedarse atrás y no dice nada. ¿Qué haces?",
  opts:[ {t:"Te acercas y le preguntas cómo se siente para entender qué le está pasando.", v:"buho"},
         {t:"Le propones cargar parte de su maleta para aligerarlo.", v:"frailejon"},
         {t:"Lo animas a aumentar el paso haciendo tú el esfuerzo de marcar el ritmo.", v:"oso"},
         {t:"Evalúas cuánto falta y sugieres un plan para ajustar el ritmo del grupo.", v:"condor"} ]},
/* 2 */ {q:"En un trabajo en grupo, notas que alguien está frustrado aunque no lo ha dicho. ¿Cómo actúas?",
  opts:[ {t:"Abres un espacio corto para que exprese qué lo está incomodando.", v:"buho"},
         {t:"Le ayudas a resolver una parte difícil de la tarea.", v:"frailejon"},
         {t:"Propones cambiar la dinámica para activar al grupo.", v:"oso"},
         {t:"Reorganizas las tareas para reducir la tensión.", v:"condor"} ]},
/* 3 */ {q:"En lunch ves a un niño de primaria aislado. ¿Qué haces?",
  opts:[ {t:"Te acercas a hablar con él para que se sienta acompañado.", v:"buho"},
         {t:"Le propones una actividad sencilla para que entre sin presión.", v:"frailejon"},
         {t:"Lo invitas a una actividad física para romper el hielo.", v:"oso"},
         {t:"Observas sus intereses y le das una sugerencia estratégica para integrarse.", v:"condor"} ]},
/* 4 */ {q:"Antes de exponer, un compañero se pone muy nervioso. ¿Qué haces?",
  opts:[ {t:"Lo escuchas y lo ayudas a regular su emoción antes de salir al frente.", v:"buho"},
         {t:"Te ofreces a leer una parte para disminuirle la carga.", v:"frailejon"},
         {t:"Le haces una mini activación rápida para liberar tensión.", v:"oso"},
         {t:"Lo ayudas a organizar sus ideas para que se sienta más seguro.", v:"condor"} ]},
/* 5 */ {q:"En una discusión del grupo, la tensión sube rápido. ¿Cómo intervienes?",
  opts:[ {t:"Pides una pausa para que todos expresen lo que sienten sin pelear.", v:"buho"},
         {t:"Facilitas un acuerdo concreto para seguir avanzando.", v:"frailejon"},
         {t:"Cambias el ambiente proponiendo algo que mueva la energía.", v:"oso"},
         {t:"Estructuras los puntos del conflicto para encontrar claridad.", v:"condor"} ]},
/* 6 */ {q:"Un compañero del equipo parece incómodo con la actividad asignada. ¿Qué haces?",
  opts:[ {t:"Le preguntas cómo se siente frente a esa tarea.", v:"buho"},
         {t:"Te ofreces a intercambiarle la actividad si lo ayuda.", v:"frailejon"},
         {t:"Lo impulsas a intentarlo como un reto personal.", v:"oso"},
         {t:"Sugieres reorganizar roles para equilibrar al equipo.", v:"condor"} ]},
/* 7 */ {q:"En un descanso, alguien hace un comentario que hiere a otro sin querer. ¿Cómo reaccionas?",
  opts:[ {t:"Te acercas al afectado para validar cómo está y acompañarlo.", v:"buho"},
         {t:"Facilitas un momento breve para aclarar el malentendido.", v:"frailejon"},
         {t:"Rediriges la energía con una acción positiva o dinámica.", v:"oso"},
         {t:"Propones hablar del comentario desde una mirada objetiva.", v:"condor"} ]},
/* 8 */ {q:"Un estudiante menor llega llorando porque perdió algo importante. ¿Qué haces?",
  opts:[ {t:"Lo acompañas emocionalmente hasta que pueda hablar.", v:"buho"},
         {t:"Le ayudas a buscar el objeto o a pedir apoyo.", v:"frailejon"},
         {t:"Lo motivas a moverse contigo para distraerse mientras buscan.", v:"oso"},
         {t:"Organizas una búsqueda rápida por zonas probables.", v:"condor"} ]},
/* 9 */ {q:"Alguien del grupo no se atreve a participar por miedo a equivocarse. ¿Qué haces?",
  opts:[ {t:"Le dices que su voz es importante y lo animas desde la empatía.", v:"buho"},
         {t:"Le propones participar en una parte pequeñita para empezar.", v:"frailejon"},
         {t:"Te ofreces a acompañarlo en la acción para romper el miedo.", v:"oso"},
         {t:"Le das una estrategia para que aporte desde lo que mejor maneja.", v:"condor"} ]},
/*10 */ {q:"En una caminata notas que el ambiente emocional del grupo decae. ¿Qué haces?",
  opts:[ {t:"Nombras algo positivo que observas en cada uno para reconectar.", v:"buho"},
         {t:"Sugieres una pausa corta para hidratarse y reorganizarse.", v:"frailejon"},
         {t:"Lanzas un reto rápido que reactive la energía.", v:"oso"},
         {t:"Propones un plan para ajustar el ritmo y avanzar mejor.", v:"condor"} ]},

/*11 */ {q:"En un reto, un compañero no entiende la instrucción. ¿Qué haces?",
  opts:[ {t:"Lo escuchas primero para entender qué parte le confunde.", v:"buho"},
         {t:"Se la explicas de manera clara y simple para que pueda avanzar.", v:"frailejon"},
         {t:"Lo guías paso a paso mientras actúa para que lo logre rápido.", v:"oso"},
         {t:"Le haces un esquema visual para que lo entienda mejor.", v:"condor"} ]},
/*12 */ {q:"En un proyecto, el grupo está estresado por el tiempo. ¿Cómo ayudas?",
  opts:[ {t:"Preguntas qué parte los tiene más estresados.", v:"buho"},
         {t:"Tomas una tarea pendiente y la sacas adelante.", v:"frailejon"},
         {t:"Propones dividir el trabajo para avanzar más rápido.", v:"oso"},
         {t:"Sugieres priorizar las tareas más importantes.", v:"condor"} ]},
/*13 */ {q:"En una caminata, alguien se queda sin agua. ¿Qué haces?",
  opts:[ {t:"Le preguntas si se siente bien y cómo va físicamente.", v:"buho"},
         {t:"Le compartes parte de la tuya o buscas más.", v:"frailejon"},
         {t:"Lo animas a caminar un poco más hasta la próxima parada.", v:"oso"},
         {t:"Calculas cuánto falta para decidir la mejor acción.", v:"condor"} ]},
/*14 */ {q:"En una caminata, alguien no logra subir una parte del trayecto. ¿Qué haces?",
  opts:[ {t:"Le preguntas qué siente y lo acompañas.", v:"buho"},
         {t:"Le das apoyo físico o buscas una forma de aliviar el esfuerzo.", v:"frailejon"},
         {t:"Lo motivas a subir contigo marcando el ritmo.", v:"oso"},
         {t:"Analizas una ruta alternativa si es necesario.", v:"condor"} ]},
/*15 */ {q:"En un trabajo, un compañero no logra completar una parte. ¿Qué haces?",
  opts:[ {t:"Lo escuchas para entender por qué le ha costado.", v:"buho"},
         {t:"Te sientas con él para ayudarlo paso a paso.", v:"frailejon"},
         {t:"Le propones turnarse para avanzar más rápido.", v:"oso"},
         {t:"Reordenas el trabajo para que sea más manejable.", v:"condor"} ]},
/*16 */ {q:"Durante un proyecto, falta alguien que se había comprometido con una parte. ¿Qué haces?",
  opts:[ {t:"Intentas llamarlo para saber cómo está y qué pasó.", v:"buho"},
         {t:"Asumes su responsabilidad y la haces rápidamente.", v:"frailejon"},
         {t:"Llamas a alguien para hacerlo entre dos.", v:"oso"},
         {t:"Evalúas qué es lo más importante y le das prioridad.", v:"condor"} ]},
/*17 */ {q:"Un estudiante pequeño no entiende la regla de un juego. ¿Cómo actúas?",
  opts:[ {t:"Lo tranquilizas y le explicas con calma.", v:"buho"},
         {t:"Juegas con él una ronda para que lo aprenda.", v:"frailejon"},
         {t:"Le muestras activamente qué debe hacer.", v:"oso"},
         {t:"Le das un truco sencillo para recordarlo.", v:"condor"} ]},
/*18 */ {q:"En un equipo, alguien tiene demasiadas responsabilidades. ¿Qué haces?",
  opts:[ {t:"Le preguntas cómo se siente con la carga que tiene.", v:"buho"},
         {t:"Te ofreces a asumir una parte de sus responsabilidades.", v:"frailejon"},
         {t:"Propones trabajar juntos un momento para avanzar.", v:"oso"},
         {t:"Reorganizas funciones para equilibrar el equipo.", v:"condor"} ]},
/*19 */ {q:"En una caminata, alguien se tropieza y cae. ¿Qué haces primero?",
  opts:[ {t:"Preguntas si está bien y cómo se siente.", v:"buho"},
         {t:"Lo ayudas a levantarse y revisas si puede continuar.", v:"frailejon"},
         {t:"Lo mueves un poco para evitar rigidez.", v:"oso"},
         {t:"Evalúas si deben parar o seguir la ruta.", v:"condor"} ]},
/*20 */ {q:"En un reto, varios no entienden qué hacer. ¿Qué haces?",
  opts:[ {t:"Preguntas qué parte está generando confusión.", v:"buho"},
         {t:"Explicas otra vez con calma y ejemplos.", v:"frailejon"},
         {t:"Lo muestras haciendo tú el primer paso.", v:"oso"},
         {t:"Clarificas los objetivos para que todos lo entiendan.", v:"condor"} ]},

/*21 */ {q:"El grupo está muy cansado en una actividad. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo se sienten para entender el cansancio.", v:"buho"},
         {t:"Ayudas activamente a quien tenga más dificultad física para seguir el ritmo.", v:"frailejon"},
         {t:"Aumentas el ritmo y motivas a que te sigan.", v:"oso"},
         {t:"Propones una estrategia para ser más eficientes.", v:"condor"} ]},
/*22 */ {q:"Un reto físico está siendo muy difícil para todos. ¿Qué haces?",
  opts:[ {t:"Observas cómo se sienten y los escuchas antes de actuar.", v:"buho"},
         {t:"Propones dividir la tarea en partes más pequeñas para que todos puedan avanzar.", v:"frailejon"},
         {t:"Das el primer paso tú para motivar al grupo a seguir.", v:"oso"},
         {t:"Buscas una forma de ajustar la dificultad sin que nadie se quede atrás.", v:"condor"} ]},
/*23 */ {q:"En la clase de educación física deben realizar un ejercicio que requiere fuerza y coordinación. ¿Cómo actúas?",
  opts:[ {t:"Te aseguras de que todos estén preparados.", v:"buho"},
         {t:"Tomas la iniciativa y realizas el ejercicio demostrando la técnica.", v:"frailejon"},
         {t:"Motivas al grupo con energía para que todos participen.", v:"oso"},
         {t:"Planificas cómo organizar la actividad para que sea segura y eficiente.", v:"condor"} ]},
/*24 */ {q:"En una caminata, el grupo se estanca ante un obstáculo. ¿Qué haces?",
  opts:[ {t:"Preguntas quién necesita ayuda.", v:"buho"},
         {t:"Buscas una forma concreta de ayudar a pasar.", v:"frailejon"},
         {t:"Lo pasas tú primero para mostrar que sí se puede.", v:"oso"},
         {t:"Analizas una ruta alternativa si es necesario.", v:"condor"} ]},
/*25 */ {q:"Están aburridos durante una espera larga. ¿Qué haces?",
  opts:[ {t:"Preguntas si todos sienten lo mismo que tú.", v:"buho"},
         {t:"Propones una mini actividad física sencilla para pasar el tiempo.", v:"frailejon"},
         {t:"Lanzas un juego activo rápido para subir la energía.", v:"oso"},
         {t:"Planteas planear la siguiente actividad para que tengan claridad de lo que viene.", v:"condor"} ]},
/*26 */ {q:"En un juego de equipo, todos están pasivos. ¿Qué haces?",
  opts:[ {t:"Intentas entender cómo está la energía del grupo.", v:"buho"},
         {t:"Propones ajustar la regla para facilitar el juego.", v:"frailejon"},
         {t:"Entras con energía y los impulsas a moverse.", v:"oso"},
         {t:"Evalúas qué cambio podría mejorar la dinámica.", v:"condor"} ]},
/*27 */ {q:"Se necesita alguien que lidere una parte del evento. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo se sienten con el liderazgo y, según eso, eliges a alguien.", v:"buho"},
         {t:"Te ofreces a ayudar al líder asignado.", v:"frailejon"},
         {t:"Tomas la iniciativa y lideras tú mismo.", v:"oso"},
         {t:"Observas quién es la mejor opción y lo propones.", v:"condor"} ]},
/*28 */ {q:"En un reto creativo, nadie se atreve a empezar. ¿Qué haces?",
  opts:[ {t:"Invitas a hablar sobre la idea general y cómo hacerla.", v:"buho"},
         {t:"Juntas algunos materiales y armas la base.", v:"frailejon"},
         {t:"Empiezas a crear algo para que los demás sigan.", v:"oso"},
         {t:"Planteas una idea inicial organizada.", v:"condor"} ]},
/*29 */ {q:"Deben mover objetos de un lugar a otro. ¿Qué haces?",
  opts:[ {t:"Preguntas quién se siente preparado para asumir la responsabilidad.", v:"buho"},
         {t:"Ayudas a organizar el orden de traslado.", v:"frailejon"},
         {t:"Empiezas a cargarlos de inmediato.", v:"oso"},
         {t:"Planificas una ruta para optimizar el tiempo.", v:"condor"} ]},
/*30 */ {q:"Se baja la energía del grupo. ¿Qué haces?",
  opts:[ {t:"Observas el ánimo y lo conversas con el grupo.", v:"buho"},
         {t:"Propones un descanso útil.", v:"frailejon"},
         {t:"Haces una activación rápida para subir la energía.", v:"oso"},
         {t:"Reorganizas la actividad para retomar el foco.", v:"condor"} ]},

/*31 */ {q:"En una caminata deben decidir si seguir o parar. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo se siente cada uno emocionalmente.", v:"buho"},
         {t:"Ofreces agua o apoyo físico antes de decidir.", v:"frailejon"},
         {t:"Propones moverse un poco para ver cómo responde el cuerpo.", v:"oso"},
         {t:"Analizas distancia, clima y tiempo para decidir objetivamente.", v:"condor"} ]},
/*32 */ {q:"En una discusión del grupo no avanzan. ¿Cómo intervienes?",
  opts:[ {t:"Preguntas cómo se sienten con la decisión.", v:"buho"},
         {t:"Aclaras lo que cada uno necesita para avanzar.", v:"frailejon"},
         {t:"Propones una acción rápida para destrabar.", v:"oso"},
         {t:"Estructuras el problema y planteas opciones claras.", v:"condor"} ]},
/*33 */ {q:"Deben armar un recorrido por el colegio. ¿Cómo ayudas?",
  opts:[ {t:"Preguntas qué partes del recorrido entusiasman más al grupo.", v:"buho"},
         {t:"Sugieres ofrecer apoyo físico en las zonas más exigentes.", v:"frailejon"},
         {t:"Propones recorrer juntos una parte del trayecto como prueba.", v:"oso"},
         {t:"Haces un plan con tiempos y secuencia de paradas para optimizar el recorrido.", v:"condor"} ]},
/*34 */ {q:"El grupo está improvisando demasiado. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo se sienten con el caos.", v:"buho"},
         {t:"Te ofreces a apoyar donde haga falta.", v:"frailejon"},
         {t:"Tomas acción para empezar algo concreto.", v:"oso"},
         {t:"Propones una estructura para no perder tiempo.", v:"condor"} ]},
/*35 */ {q:"En un reto, todos hablan a la vez. ¿Cómo reaccionas?",
  opts:[ {t:"Pides que cada uno exprese cómo se siente.", v:"buho"},
         {t:"Propones que hablen por turnos.", v:"frailejon"},
         {t:"Los invitas a hacer una pausa activa.", v:"oso"},
         {t:"Ordenas ideas y priorizas lo más relevante.", v:"condor"} ]},
/*36 */ {q:"El equipo debe elegir entre dos caminos. ¿Qué haces?",
  opts:[ {t:"Exploras cómo se sienten frente a cada opción.", v:"buho"},
         {t:"Ayudas a preparar físicamente lo necesario.", v:"frailejon"},
         {t:"Propones probar un tramo de cada uno.", v:"oso"},
         {t:"Comparas riesgos y beneficios para decidir.", v:"condor"} ]},
/*37 */ {q:"En un proyecto, el grupo se está desviando. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo se sienten con la nueva dirección.", v:"buho"},
         {t:"Ayudas a resolver lo que quedó atrasado.", v:"frailejon"},
         {t:"Tomas acción en una parte concreta.", v:"oso"},
         {t:"Rediriges al equipo hacia los objetivos iniciales.", v:"condor"} ]},
/*38 */ {q:"En una caminata escuchas dos rutas posibles para llegar. ¿Qué haces?",
  opts:[ {t:"Preguntas cómo ve el grupo cada opción.", v:"buho"},
         {t:"Ofreces apoyo para cualquiera que elijan.", v:"frailejon"},
         {t:"Sugieres avanzar un poco para decidir sobre la marcha.", v:"oso"},
         {t:"Comparas mapas, tiempo y nivel de dificultad.", v:"condor"} ]},
/*39 */ {q:"En un evento falta organización. ¿Qué aportas?",
  opts:[ {t:"Observas cómo está el ambiente para saber cómo intervenir.", v:"buho"},
         {t:"Tomas una tarea y la sacas adelante.", v:"frailejon"},
         {t:"Activas al grupo para que se mueva.", v:"oso"},
         {t:"Creas un orden de pasos para avanzar.", v:"condor"} ]},
/*40 */ {q:"En un reto mental, el grupo se bloquea. ¿Qué haces?",
  opts:[ {t:"Preguntas qué los bloquea y creas un espacio seguro para hablar.", v:"buho"},
         {t:"Ayudas a alguien con la parte que le cuesta.", v:"frailejon"},
         {t:"Propones intentar una solución arriesgada.", v:"oso"},
         {t:"Analizas patrones para encontrar la lógica del reto.", v:"condor"} ]},
]; // end QUESTIONS

/* =========================
   LÓGICA: mezclar, paginar, respuestas
   ========================= */
let shuffledQs = QUESTIONS.slice().sort(()=> Math.random() - 0.5); // random order
const PAGE_SIZE = 10;
let currentPage = 0;
const totalPages = Math.ceil(shuffledQs.length / PAGE_SIZE);
const answers = {}; // key: global question index -> 'buho'|'frailejon'|'oso'|'condor'

const quizDiv = document.getElementById('quiz');
const progressBar = document.getElementById('progressBar');
const pageInfo = document.getElementById('pageInfo');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resultDiv = document.getElementById('result');

function escapeHtml(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

/* render single page of questions */
function renderPage(){
  quizDiv.innerHTML = "";
  const start = currentPage * PAGE_SIZE;
  const pageQs = shuffledQs.slice(start, start + PAGE_SIZE);

  pageQs.forEach((qItem, i) => {
    const globalIndex = start + i;
    const qBox = document.createElement('div');
    qBox.className = 'page active question';
    qBox.innerHTML = `<h4>${globalIndex+1}. ${escapeHtml(qItem.q)}</h4><div class="opts" id="opts_${globalIndex}"></div>`;
    quizDiv.appendChild(qBox);

    const optsDiv = document.getElementById(`opts_${globalIndex}`);
    // shuffle options too
    const optsShuffled = qItem.opts.slice().sort(()=> Math.random() - 0.5);
    optsShuffled.forEach((opt, oi) => {
      const id = `q_${globalIndex}_o_${oi}`;
      const pillClass = opt.v === 'buho' ? 'buho' : opt.v === 'frailejon' ? 'fraile' : opt.v === 'oso' ? 'oso' : 'condor';
      const pillLetter = opt.v === 'buho' ? 'A' : opt.v === 'frailejon' ? 'B' : opt.v === 'oso' ? 'C' : 'D';

      // create label with visible radio input (so user sees selection)
      const label = document.createElement('label');
      label.className = 'opt';
      label.htmlFor = id;

      label.innerHTML = `
        <div class="pill ${pillClass}">${pillLetter}</div>
        <div style="flex:1;display:flex;gap:10px;align-items:flex-start">
          <input type="radio" name="q_${globalIndex}" id="${id}" value="${opt.v}" />
          <div style="min-height:1.2em">${escapeHtml(opt.t)}</div>
        </div>
      `;

      // set initial checked state if already answered
      const radioInput = label.querySelector('input[type="radio"]');
      if(answers[globalIndex] === opt.v){
        radioInput.checked = true;
        label.classList.add('selected');
      }

      // when clicking label or input -> set answer, mark selected
      const setAnswer = () => {
        answers[globalIndex] = opt.v;
        // unselect sibling labels in this optsDiv
        const siblings = optsDiv.querySelectorAll('label.opt');
        siblings.forEach(s => s.classList.remove('selected'));
        label.classList.add('selected');
        // ensure actual radio checked
        const r = label.querySelector('input[type="radio"]');
        if(r) r.checked = true;
        updateProgress();
      };

      // input change event
      radioInput.addEventListener('change', setAnswer);
      // label click (covers clicking outer area)
      label.addEventListener('click', (e) => {
        setAnswer();
      });

      optsDiv.appendChild(label);
    });
  });

  // update nav
  prevBtn.disabled = currentPage === 0;
  nextBtn.textContent = currentPage === totalPages - 1 ? 'Finalizar' : 'Siguiente';
  updateProgress();
  pageInfo.textContent = `Página ${currentPage+1} / ${totalPages} · Respondidas ${Object.keys(answers).length} / ${shuffledQs.length}`;
}

/* update progress UI */
function updateProgress(){
  const done = Object.keys(answers).length;
  const pct = Math.round((done / shuffledQs.length) * 100);
  progressBar.style.width = pct + '%';
  pageInfo.textContent = `Página ${currentPage+1} / ${totalPages} · Respondidas ${done} / ${shuffledQs.length}`;
}

/* navigation */
function nextPage(){
  // validate current page all answered
  const start = currentPage * PAGE_SIZE;
  const end = Math.min(start + PAGE_SIZE, shuffledQs.length);
  for(let i=start;i<end;i++){
    if(!answers.hasOwnProperty(i)){
      alert('Por favor responde todas las preguntas de la página antes de continuar. Falta la pregunta ' + (i+1));
      document.getElementById(`opts_${i}`).scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }
  }

  if(currentPage < totalPages - 1){
    currentPage++;
    renderPage();
    window.scrollTo({top:0,behavior:'smooth'});
  } else {
    computeResults();
  }
}

function prevPage(){
  if(currentPage>0){ currentPage--; renderPage(); window.scrollTo({top:0,behavior:'smooth'}); }
}

/* compute results & render final screen (same page) */
function computeResults(){
  // tally
  const counts = { buho:0, frailejon:0, oso:0, condor:0 };
  for(let i=0;i<shuffledQs.length;i++){
    const v = answers[i];
    if(v && counts.hasOwnProperty(v)) counts[v]++;
  }
  const total = counts.buho + counts.frailejon + counts.oso + counts.condor || 1;
  const percent = {
    buho: Math.round(counts.buho / total * 100),
    frailejon: Math.round(counts.frailejon / total * 100),
    oso: Math.round(counts.oso / total * 100),
    condor: Math.round(counts.condor / total * 100)
  };
  // dominant
  const ordered = Object.entries(percent).sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0]));
  const dominantKey = ordered[0][0];

  // hide quiz
  document.querySelector('.progress').style.display = 'none';
  document.querySelector('.nav').style.display = 'none';
  quizDiv.style.display = 'none';

  // prepare profile content
  const profiles = {
    buho: {
      title: 'BÚHO — Lidera desde la empatía',
      color: 'var(--accent)',
      badgeColor: '#2f6b3a',
      desc: 'Lideras poniendo atención al clima emocional y a la inclusión. Generas espacios donde las personas se sienten escuchadas y cuidadas.',
      characteristics: ['Escucha activa','Sensibilidad emocional','Capacidad para mediar'],
      motivates: ['Apoyar a otros','Mantener la armonía','Que todos participen'],
      values: ['Empatía','Respeto','Cuidado mutuo'],
      communication: 'Prefieres conversaciones cara a cara y tiempos de escucha. Respondes bien a preguntas abiertas.',
      shadows: ['Evitar confrontaciones necesarias','Sobrecarga emocional','Dificultad para decisiones impopulares'],
      dofa: {
        F:['Conexión interpersonal','Habilidad de contención','Promueve cohesión'],
        O:['Formación en límites y asertividad','Rol de facilitador escolar'],
        D:['Sobrecarga emocional','Priorizar relaciones sobre resultados'],
        A:['Burnout emocional','Ser percibido como poco firme']
      },
      recs: ['Practica decir "no" cuando haga falta','Alíate con perfiles decisores','Reserva tiempo para recuperarte']
    },
    frailejon: {
      title: 'FRAILEJÓN — Lidera desde el servicio',
      color: 'var(--fraile)',
      badgeColor: '#b07f2d',
      desc: 'Sostienes la operación con acciones concretas. Te preocupas porque todo funcione y porque nadie quede atrás.',
      characteristics: ['Disponibilidad','Constancia','Fiabilidad operativa'],
      motivates: ['Ver al equipo avanzar','Apoyar a quienes lo necesitan','Contribuir al bien común'],
      values: ['Servicio','Responsabilidad','Humildad'],
      communication: 'Mensajes prácticos y orientados a la ayuda. Aprecias reconocimiento por tu aporte.',
      shadows: ['Asumir demasiadas tareas','Dificultad para pedir apoyo'],
      dofa: {
        F:['Sostén operativo','Alta disponibilidad','Consistencia'],
        O:['Visibilizar aportes','Delegar mejor'],
        D:['Riesgo de agotamiento','Menos búsqueda de reconocimiento'],
        A:['Ser pasado por alto','Agotamiento físico/emocional']
      },
      recs: ['Establece límites y prioridades','Pide reconocimiento cuando haga falta','Practica delegar']
    },
    oso: {
      title: 'OSO ANDINO — Lidera desde la acción',
      color: 'var(--oso)',
      badgeColor: '#6d4b32',
      desc: 'Actúas con iniciativa: arrancas, ejecutas y movilizas al equipo para que avance y consiga resultados visibles.',
      characteristics: ['Iniciativa','Energía','Resiliencia práctica'],
      motivates: ['Retos reales','Resultados visibles','Superar obstáculos'],
      values: ['Acción','Disciplina','Compromiso'],
      communication: 'Directo y concreto; valoras instrucciones claras y feedback inmediato.',
      shadows: ['Impulsividad','Impaciencia','Tendencia a cargar demasiado'],
      dofa: {
        F:['Alta ejecución','Ejemplo movilizador','Resiliencia'],
        O:['Formación en planificación','Alianzas con analíticos'],
        D:['Impulsividad','Poca visión a largo plazo'],
        A:['Desgaste físico/mental','Conflictos por estilo directo']
      },
      recs: ['Toma micro-pausas para reflexionar','Alíate con perfiles estructurados','Comunica el porqué']
    },
    condor: {
      title: 'CÓNDOR — Lidera desde la razón y la estrategia',
      color: 'var(--condor)',
      badgeColor: '#254f8a',
      desc: 'Aportas estructura, análisis y claridad. Te encargas de organizar, planificar y justificar decisiones con criterios claros.',
      characteristics: ['Pensamiento analítico','Organización','Toma de decisiones fundamentada'],
      motivates: ['Resolver problemas complejos','Optimizar procesos','Trabajar con evidencia'],
      values: ['Claridad','Precisión','Eficiencia'],
      communication: 'Estructurada y lógica; valoras datos y pasos claros.',
      shadows: ['Distanciamiento emocional','Exceso de análisis'],
      dofa: {
        F:['Capacidad analítica','Organización','Visión estratégica'],
        O:['Desarrollar empatía comunicativa','Métodos ágiles para evitar parálisis'],
        D:['Rigidez','Dificultad para gestionar incertidumbre'],
        A:['Percepción de frialdad','Resistencia en equipos menos estructurados']
      },
      recs: ['Sintetiza ideas en 1–2 frases','Valida emociones antes de presentar datos','Usa prototipos para evitar parálisis']
    }
  };

  // render result container
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = `
    <div class="grid2" id="resultGrid" style="align-items:start">
      <div class="profileCard" id="leftCard">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div style="font-size:13px;color:var(--muted)">Resultados</div>
            <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
              <div style="padding:10px;border-radius:12px;background:rgba(138,166,138,0.08)"><strong>Búho</strong><div style="font-size:20px;color:var(--accent)">${percent.buho}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(217,191,87,0.06)"><strong>Frailejón</strong><div style="font-size:20px;color:var(--fraile)">${percent.frailejon}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(139,106,74,0.06)"><strong>Oso</strong><div style="font-size:20px;color:var(--oso)">${percent.oso}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(74,111,177,0.06)"><strong>Cóndor</strong><div style="font-size:20px;color:var(--condor)">${percent.condor}%</div></div>
            </div>
          </div>
          <div style="min-width:210px;text-align:right">
            <div class="dominantTitle" id="dominantBig">${profiles[dominantKey].title.split('—')[0].trim()}</div>
            <div class="dominantSubtitle">${profiles[dominantKey].title.split('—')[1].trim()}</div>
            <div><span class="dominantBadge" id="dominantBadge" style="background:${profiles[dominantKey].badgeColor};font-size:15px">${profiles[dominantKey].title.split('—')[1].trim()}</span></div>
          </div>
        </div>

        <div style="margin-top:12px;background:linear-gradient(180deg,#fff,#fbfbfb);padding:12px;border-radius:10px;border:1px solid var(--line)">
          <canvas id="radarChart" style="max-height:360px;"></canvas>
        </div>

        <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap">
          <button class="primary" id="downloadPdfBtn">Descargar PDF (completo)</button>
          <button class="ghost" id="restartBtn">Reiniciar test</button>
        </div>
      </div>

      <div class="profileCard" id="profileLong">
        <!-- perfil largo será insertado aquí -->
      </div>
    </div>
  `;

  // fill full profile on right card
  const p = profiles[dominantKey];
  const profileLong = document.getElementById('profileLong');
  profileLong.innerHTML = `
    <h3 style="margin:0 0 6px">${p.title}</h3>
    <p style="margin:0 0 12px;color:var(--muted)"><em>${p.desc}</em></p>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div>
        <strong>Características</strong>
        <ul>${p.characteristics.map(x=>`<li>${x}</li>`).join('')}</ul>
        <strong>Motivaciones</strong>
        <ul>${p.motivates.map(x=>`<li>${x}</li>`).join('')}</ul>
      </div>
      <div>
        <strong>Qué valoras en tu equipo</strong>
        <ul>${p.values.map(x=>`<li>${x}</li>`).join('')}</ul>
        <strong>Cómo comunicarse contigo</strong>
        <p style="margin:6px 0 0">${p.communication}</p>
      </div>
    </div>

    <div style="margin-top:12px">
      <strong>Sombras</strong>
      <p style="margin:6px 0 10px">${p.shadows.join('; ')}</p>

      <h4 style="margin-top:6px">DOFA</h4>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Fortalezas</strong><ul>${p.dofa.F.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Oportunidades</strong><ul>${p.dofa.O.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Debilidades</strong><ul>${p.dofa.D.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Amenazas</strong><ul>${p.dofa.A.map(i=>`<li>${i}</li>`).join('')}</ul></div>
      </div>

      <strong style="display:block;margin-top:12px">Recomendaciones prácticas</strong>
      <ul>${p.recs.map(i=>`<li>${i}</li>`).join('')}</ul>
    </div>
  `;

  // chart
  const ctx = document.getElementById('radarChart').getContext('2d');
  const bg = dominantKey === 'buho' ? 'rgba(138,166,138,0.16)' :
             dominantKey === 'frailejon' ? 'rgba(217,191,87,0.14)' :
             dominantKey === 'oso' ? 'rgba(139,106,74,0.12)' :
             'rgba(74,111,177,0.12)';

  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Búho','Frailejón','Oso Andino','Cóndor'],
      datasets: [{
        label: 'Porcentaje',
        data: [percent.buho, percent.frailejon, percent.oso, percent.condor],
        fill: true,
        backgroundColor: bg,
        borderColor: (dominantKey==='buho'? '#8aa68a' : dominantKey==='frailejon'? '#d9bf57' : dominantKey==='oso'? '#8b6a4a' : '#4a6fb1'),
        pointBackgroundColor:['#8aa68a','#d9bf57','#8b6a4a','#4a6fb1'],
        pointBorderColor:'#fff',
        pointHoverBorderColor:'#000'
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero:true,
          suggestedMax:100,
          ticks:{stepSize:20, color: '#4b5563'},
          grid: { color: '#ecf0ef' },
          angleLines: { color: '#ecf0ef' },
          pointLabels: { color: '#4b5563' }
        }
      },
      plugins:{legend:{display:false}},
      elements: { line: { borderWidth: 2 } }
    }
  });

  /* ===== PDF: Render por secciones y exportar (multi-page si hace falta) ===== */
  document.getElementById('downloadPdfBtn').addEventListener('click', async ()=> {
    const target = document.getElementById('resultGrid');
    if(!target) return alert('No hay resultados para exportar');

    // clone and prepare (ensure width consistent)
    const clone = target.cloneNode(true);
    const wrapper = document.createElement('div');
    wrapper.style.width = '900px';
    wrapper.style.padding = '24px';
    wrapper.style.background = '#fff';
    wrapper.style.boxSizing = 'border-box';
    wrapper.appendChild(clone);
    document.body.appendChild(wrapper);

    // replace canvas with image in clone (chart)
    try {
      const origCanvas = document.querySelector('#radarChart');
      if(origCanvas){
        const dataUrl = origCanvas.toDataURL('image/png');
        const clonedCanvas = clone.querySelector('canvas');
        if(clonedCanvas && clonedCanvas.parentNode){
          const img = document.createElement('img');
          img.src = dataUrl;
          img.style.width = '100%';
          img.style.height = 'auto';
          clonedCanvas.parentNode.replaceChild(img, clonedCanvas);
        }
      }
    } catch(e){ /* ignore */ }

    // render wrapper to canvas
    const scale = 2; // improve quality
    const canvasRender = await html2canvas(wrapper, {scale: scale, useCORS:true, backgroundColor: '#ffffff'});
    wrapper.remove();

    // create pdf with exact pixel dimensions (unit: px)
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({orientation:'portrait', unit:'px', format:[canvasRender.width, canvasRender.height]});
    const imgData = canvasRender.toDataURL('image/png');
    pdf.addImage(imgData, 'PNG', 0, 0, canvasRender.width, canvasRender.height);
    const filename = `Resultados_Arquetipo_${(new Date()).toISOString().slice(0,19).replace(/[:T]/g,'_')}.pdf`;
    pdf.save(filename);
  });

  // restart
  document.getElementById('restartBtn').addEventListener('click', ()=> location.reload());
} // end computeResults

// initial render
renderPage();
updateProgress();

</script>
</body>
</html>
