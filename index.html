<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test de Arquetipos de Liderazgo — Escolar (Versión Definitiva)</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2canvas + jsPDF para generar PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  /* ---------- PÁRAMO: paleta limpia, acento verde/amarillo/terroso ---------- */
  :root{
    --bg: #f6f8f7;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #8aa68a; /* verde páramo */
    --fraile: #d9bf57; /* amarillo frailejón */
    --oso: #8b6a4a; /* marrón terroso */
    --condor: #4a6fb1; /* azul cóndor */
    --line: #e7e9eb;
    --text: #0f172a;
    --glass: rgba(255,255,255,0.85);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;background:linear-gradient(180deg,#fbfdfc 0%, #f6f8f7 100%)}
  body{
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--text);
    padding:28px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .wrap{
    max-width:1000px;margin:0 auto;background:var(--card);border-radius:16px;padding:26px;border:1px solid var(--line);
    box-shadow:0 12px 40px rgba(15,23,42,0.06);
  }

  header{display:flex;gap:18px;align-items:center}
  .logo{
    width:74px;height:74px;border-radius:14px;background:linear-gradient(180deg,var(--accent),#b7d4b2);
    display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;font-size:20px;
    box-shadow:0 6px 18px rgba(138,166,138,0.14);
  }
  h1{margin:0;font-size:22px;line-height:1.05}
  p.lead{margin:6px 0 18px;color:var(--muted);line-height:1.45}
  .meta{display:flex;gap:12px;align-items:center;margin-bottom:8px}

  .progress{height:14px;background:#f2f6f2;border-radius:999px;overflow:hidden;margin:18px 0;border:1px solid var(--line)}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#cfe6cf);width:0%;transition:width .25s ease}

  #quiz{margin-top:8px}
  .page{display:none}
  .page.active{display:block}

  .question{
    border:1px solid var(--line);background:linear-gradient(180deg,#ffffff,#fbfefb);border-radius:12px;padding:14px;margin-bottom:14px;
    box-shadow:0 6px 20px rgba(12,18,12,0.02);
  }
  .question h4{margin:0 0 10px;font-size:15.5px}
  .opts{display:flex;flex-direction:column;gap:10px;margin-top:6px}

  /* option styling */
  label.opt{
    display:flex;gap:14px;align-items:flex-start;padding:12px;border-radius:10px;background:var(--glass);border:1px solid #f1f4f1;cursor:pointer;
    transition:transform .12s, box-shadow .12s, border-color .12s;user-select:none;
  }
  label.opt:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(12,22,14,0.05)}
  label.opt input[type="radio"]{margin-top:3px;transform:scale(1.1)}
  label.opt .pill{
    min-width:38px;padding:8px;border-radius:8px;color:#fff;font-weight:800;text-align:center;
    font-size:13px;line-height:1;
  }
  .pill.buho{background:var(--accent)}
  .pill.fraile{background:var(--fraile)}
  .pill.oso{background:var(--oso)}
  .pill.condor{background:var(--condor)}

  /* selected visual */
  label.opt.selected{
    border-color:rgba(0,0,0,0.06);
    box-shadow:0 10px 28px rgba(0,0,0,0.06);
    transform:translateY(-2px);
    background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,255,250,0.95));
  }

  .nav{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:18px}
  .nav .info{color:var(--muted);font-size:14px}
  .controls{display:flex;gap:10px}

  button.primary{
    background:linear-gradient(180deg,var(--accent),#699a6a);color:#083012;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:800;
    box-shadow:0 12px 30px rgba(86,129,86,0.12);font-size:15px;
  }
  button.ghost{
    background:#fff;color:var(--text);border:1px solid var(--line);padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:700;
  }
  button.ghost[disabled]{opacity:.5;cursor:not-allowed}

  #result{display:none;margin-top:18px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .profileCard{background:linear-gradient(180deg,#ffffff,#fbfefb);border-radius:12px;padding:16px;border:1px solid var(--line)}
  .dominantTitle{font-family:"Georgia","Times New Roman",serif;font-size:36px;color:var(--text);margin:4px 0}
  .dominantSubtitle{font-size:14px;color:var(--muted);margin-bottom:8px}
  .dominantBadge{display:inline-block;padding:10px 14px;border-radius:999px;font-weight:900;color:#fff}
  .small{font-size:13px;color:var(--muted)}
  footer.small{margin-top:16px;color:var(--muted);font-size:13px}

  /* responsive */
  @media(max-width:900px){
    .grid2{grid-template-columns:1fr}
    .logo{width:58px;height:58px}
    .dominantTitle{font-size:28px}
  }

  /* PDF-friendly hidden helper */
  .printHidden{display:none}
</style>
</head>
<body>
  <div class="wrap" id="appWrap">
    <header>
      <div class="logo">TN</div>
      <div>
        <h1>Test de Arquetipos de Liderazgo — Escolar</h1>
        <p class="lead">Responde con la acción que **realmente** harías — no lo que suena mejor. Son 40 situaciones: 10 por arquetipo. Las preguntas aparecen en orden aleatorio (10 por página).</p>
        <div class="meta"><span class="small">Diseño inspirado en los páramos — tonos verdes, terrosos y azules.</span></div>
      </div>
    </header>

    <div class="progress" aria-hidden="true"><i id="progressBar" style="width:0%"></i></div>

    <div id="quiz" role="list"></div>

    <div class="nav" aria-hidden="false">
      <div class="info" id="pageInfo">Página 1 / 4 · Respondidas 0 / 40</div>
      <div class="controls">
        <button id="prevBtn" class="ghost" onclick="prevPage()" disabled>Anterior</button>
        <button id="nextBtn" class="primary" onclick="nextPage()">Siguiente</button>
      </div>
    </div>

    <div id="result" aria-live="polite"></div>

    <footer class="small">Sustento: Greenleaf, Goleman y teorías contemporáneas sobre liderazgo situacional y emocional — adaptado para contexto escolar.</footer>
  </div>

<script>
/* =========================
   PREGUNTAS (40) — objetos (tal como diste)
   A = Búho (buho), B = Frailejón (frailejon), C = Oso (oso), D = Cóndor (condor)
   ========================= */
const QUESTIONS = [
/* 1 */ {q:"En una caminata de Latitud Norte, notas que un compañero está más callado de lo normal.",
  opts:[ {t:"Me acerco y le pregunto cómo se siente.", v:"buho"},
         {t:"Busco acompañarlo un rato para que no vaya solo.", v:"frailejon"},
         {t:"Lo motivo con algún comentario positivo.", v:"oso"},
         {t:"Le pregunto si necesita organizar mejor su paso o ritmo.", v:"condor"} ]},
/* 2 */ {q:"Durante una práctica de deporte, alguien se frustra por un error.",
  opts:[ {t:"Le digo que a todos nos pasa y lo apoyo.", v:"buho"},
         {t:"Me acerco a ayudarle a mejorar el movimiento.", v:"frailejon"},
         {t:"Le enseño cómo hacerlo con más energía.", v:"oso"},
         {t:"Lo ayudo a identificar qué puede ajustar.", v:"condor"} ]},
/* 3 */ {q:"En una reunión de equipo, alguien queda fuera de la conversación.",
  opts:[ {t:"Le doy la palabra y lo incluyo con cuidado.", v:"buho"},
         {t:"Propongo que escuchemos todas las ideas.", v:"frailejon"},
         {t:"Hago una dinámica rápida para que todos participen.", v:"oso"},
         {t:"Reorganizo cómo conversamos para evitar que se repita.", v:"condor"} ]},
/* 4 */ {q:"Antes de un reto grupal, un compañero confiesa que tiene miedo.",
  opts:[ {t:"Le cuento que es normal y lo valido.", v:"buho"},
         {t:"Le ofrezco acompañarlo durante el reto.", v:"frailejon"},
         {t:"Me ofrezco a hacerlo con él primero.", v:"oso"},
         {t:"Le explico cómo funcionará la actividad paso a paso.", v:"condor"} ]},
/* 5 */ {q:"En un descanso, ves a alguien sentado solo.",
  opts:[ {t:"Me acerco a hacerle compañía.", v:"buho"},
         {t:"Lo invito a unirse a un grupo.", v:"frailejon"},
         {t:"Le propongo movernos o caminar un rato.", v:"oso"},
         {t:"Le pregunto qué necesita y cómo integrarlo mejor.", v:"condor"} ]},
/* 6 */ {q:"En una práctica artística, alguien dice que no le salió bien.",
  opts:[ {t:"Le hablo con calma para que no se desanime.", v:"buho"},
         {t:"Me ofrezco a repetirlo juntos.", v:"frailejon"},
         {t:"Le muestro cómo hacerlo con más seguridad.", v:"oso"},
         {t:"Le explico qué puede ajustar para mejorar.", v:"condor"} ]},
/* 7 */ {q:"Un amigo te dice que está saturado con el colegio.",
  opts:[ {t:"Lo escucho y le doy un espacio seguro.", v:"buho"},
         {t:"Lo ayudo a organizar su agenda.", v:"frailejon"},
         {t:"Lo saco a moverse para liberar tensión.", v:"oso"},
         {t:"Le propongo métodos concretos para bajar carga.", v:"condor"} ]},
/* 8 */ {q:"En un trabajo en grupo, alguien está de mal humor.",
  opts:[ {t:"Pregunto si quiere hablar de lo que siente.", v:"buho"},
         {t:"Le digo que yo puedo tomar una parte si está abrumado.", v:"frailejon"},
         {t:"Propongo una pausa para bajar tensión.", v:"oso"},
         {t:"Organizo las tareas para que sea más llevadero.", v:"condor"} ]},
/* 9 */ {q:"Durante un juego cooperativo, un compañero se equivoca y se siente culpable.",
  opts:[ {t:"Le recuerdo que es parte del proceso.", v:"buho"},
         {t:"Le ofrezco apoyo para que siga intentando.", v:"frailejon"},
         {t:"Lo animo a repetirlo con energía.", v:"oso"},
         {t:"Le explico qué puede intentar distinto.", v:"condor"} ]},
/*10 */ {q:"En una conversación de curso, alguien comparte algo sensible.",
  opts:[ {t:"Cierro el espacio para que se sienta escuchado.", v:"buho"},
         {t:"Le ofrezco mi ayuda si la necesita luego.", v:"frailejon"},
         {t:"Cambio el tono de la actividad para hacerlo sentir más cómodo.", v:"oso"},
         {t:"Recuerdo al grupo la importancia de manejar la información con cuidado.", v:"condor"} ]},

/*11 */ {q:"En una caminata, alguien no logra ajustar bien su maleta.",
  opts:[ {t:"Le pregunto cómo se está sintiendo con el peso.", v:"buho"},
         {t:"Me ofrezco a ayudarle a ajustarla.", v:"frailejon"},
         {t:"Se la dejo perfecta en dos minutos.", v:"oso"},
         {t:"Le enseño una forma más eficiente de empacar.", v:"condor"} ]},
/*12 */ {q:"Durante una práctica, el profesor pide voluntarios para mover implementos.",
  opts:[ {t:"Animo a que todos cooperemos.", v:"buho"},
         {t:"Me ofrezco sin dudarlo.", v:"frailejon"},
         {t:"Lo hago rápido para avanzar.", v:"oso"},
         {t:"Propongo una manera ordenada de hacerlo.", v:"condor"} ]},
/*13 */ {q:"En un proyecto artístico, hace falta alguien que apoye detrás de escena.",
  opts:[ {t:"Reviso cómo se siente el grupo.", v:"buho"},
         {t:"Tomo el rol sin problema.", v:"frailejon"},
         {t:"Ayudo en lo físico cuando toca.", v:"oso"},
         {t:"Organizo las tareas de backstage.", v:"condor"} ]},
/*14 */ {q:"En descanso, ves que el espacio quedó desordenado.",
  opts:[ {t:"Comento que debemos cuidar el lugar.", v:"buho"},
         {t:"Lo organizo sin esperar nada.", v:"frailejon"},
         {t:"Busco a otros para hacerlo juntos.", v:"oso"},
         {t:"Propongo una forma para mantenerlo ordenado.", v:"condor"} ]},
/*15 */ {q:"En un trabajo grupal, alguien está atrasado.",
  opts:[ {t:"Pregunto cómo está y qué lo tiene abrumado.", v:"buho"},
         {t:"Le ayudo con la parte que falta.", v:"frailejon"},
         {t:"Me pongo a hacerlo rápidamente.", v:"oso"},
         {t:"Propongo redistribuir el trabajo.", v:"condor"} ]},
/*16 */ {q:"Antes de salir del colegio en una actividad, alguien olvidó un material.",
  opts:[ {t:"Le pregunto si está bien.", v:"buho"},
         {t:"Le presto lo que necesite.", v:"frailejon"},
         {t:"Voy a buscar lo que falta si es posible.", v:"oso"},
         {t:"Propongo soluciones rápidas al grupo.", v:"condor"} ]},
/*17 */ {q:"En práctica deportiva, un compañero se siente mareado.",
  opts:[ {t:"Me quedo con él y lo tranquilizo.", v:"buho"},
         {t:"Busco agua o apoyo inmediatamente.", v:"frailejon"},
         {t:"Lo acompaño físicamente a un lugar seguro.", v:"oso"},
         {t:"Sugiero cómo manejar la situación con calma.", v:"condor"} ]},
/*18 */ {q:"En un proyecto del colegio, el equipo tiene ideas muy diferentes y el avance se detiene.",
  opts:[ {t:"Escucho a todos y trato de encontrar un punto en común.", v:"buho"},
         {t:"Me adapto a la idea que mejor ayude al grupo a avanzar.", v:"frailejon"},
         {t:"Propongo organizar las ideas para tomar una decisión clara.", v:"oso"},
         {t:"Sugiero una alternativa nueva que combine lo mejor de cada propuesta.", v:"condor"} ]},
/*19 */ {q:"En un ensayo musical, falta alguien para una parte de apoyo.",
  opts:[ {t:"Pregunto cómo están todos con el ensayo.", v:"buho"},
         {t:"Tomo ese rol para ayudar.", v:"frailejon"},
         {t:"Me cambio rápido de tarea y actúo.", v:"oso"},
         {t:"Propongo reorganizar la pieza.", v:"condor"} ]},
/*20 */ {q:"En una dinámica grupal, alguien tiene dificultades para entender las instrucciones.",
  opts:[ {t:"Le explico con calma.", v:"buho"},
         {t:"Practico con él aparte.", v:"frailejon"},
         {t:"Le muestro haciéndolo.", v:"oso"},
         {t:"Le hago un resumen claro.", v:"condor"} ]},

/*21 */ {q:"En un reto físico de Latitud Norte, el grupo avanza lento.",
  opts:[ {t:"Animo al grupo para que no se frustre.", v:"buho"},
         {t:"Ayudo a quienes se quedan atrás.", v:"frailejon"},
         {t:"Tomo la delantera para marcar ritmo.", v:"oso"},
         {t:"Propongo una estrategia para avanzar mejor.", v:"condor"} ]},
/*22 */ {q:"En educación física, el grupo está disperso.",
  opts:[ {t:"Los llamo con calma para enfocarnos.", v:"buho"},
         {t:"Reparto roles rápidamente.", v:"frailejon"},
         {t:"Arranco la actividad con fuerza.", v:"oso"},
         {t:"Organizo cómo funcionará el ejercicio.", v:"condor"} ]},
/*23 */ {q:"En recreo, todos están sin energía.",
  opts:[ {t:"Pregunto qué necesitan.", v:"buho"},
         {t:"Pregunto qué actividad prefieren.", v:"frailejon"},
         {t:"Propongo algo activo de una.", v:"oso"},
         {t:"Armo un mini plan de juego.", v:"condor"} ]},
/*24 */ {q:"En un ensayo, hay que mover elementos pesados.",
  opts:[ {t:"Consulto cómo se sienten para hacerlo juntos.", v:"buho"},
         {t:"Coordino quién mueve qué.", v:"frailejon"},
         {t:"Empiezo a cargarlos.", v:"oso"},
         {t:"Propongo una ruta segura.", v:"condor"} ]},
/*25 */ {q:"El profesor pide iniciativa para arrancar un proyecto.",
  opts:[ {t:"Reviso cómo está el grupo emocionalmente.", v:"buho"},
         {t:"Ayudo a quienes no saben por dónde empezar.", v:"frailejon"},
         {t:"Comienzo a trabajar inmediatamente.", v:"oso"},
         {t:"Hago un esquema rápido.", v:"condor"} ]},
/*26 */ {q:"En un reto creativo, un compañero no sabe cómo empezar.",
  opts:[ {t:"Lo escucho y lo calmo.", v:"buho"},
         {t:"Trabajo con él paso a paso.", v:"frailejon"},
         {t:"Le muestro haciéndolo yo.", v:"oso"},
         {t:"Le explico el proceso.", v:"condor"} ]},
/*27 */ {q:"Falta poco tiempo en un trabajo manual.",
  opts:[ {t:"Calmo al grupo.", v:"buho"},
         {t:"Ayudo a quien va atrasado.", v:"frailejon"},
         {t:"Trabajo rápido y con energía.", v:"oso"},
         {t:"Divido tareas.", v:"condor"} ]},
/*28 */ {q:"Antes de una competencia amistosa, todos están indecisos.",
  opts:[ {t:"Los motivo.", v:"buho"},
         {t:"Reparto funciones.", v:"frailejon"},
         {t:"Salgo al frente para activarnos.", v:"oso"},
         {t:"Repaso la estrategia.", v:"condor"} ]},
/*29 */ {q:"En una actividad al aire libre, hay que montar un espacio.",
  opts:[ {t:"Pregunto quién necesita apoyo.", v:"buho"},
         {t:"Ayudo a montar.", v:"frailejon"},
         {t:"Lo hago rápido y voy por más.", v:"oso"},
         {t:"Propongo una forma ordenada.", v:"condor"} ]},
/*30 */ {q:"En un simulacro, hay confusión.",
  opts:[ {t:"Calmo al grupo.", v:"buho"},
         {t:"Ayudo a quienes se quedaron atrás.", v:"frailejon"},
         {t:"Tomo la iniciativa y sigo la ruta.", v:"oso"},
         {t:"Organizo la información.", v:"condor"} ]},

/*31 */ {q:"El profesor da instrucciones muy generales.",
  opts:[ {t:"Pregunto cómo se sienten con la tarea.", v:"buho"},
         {t:"Organizo pequeñas partes con el grupo.", v:"frailejon"},
         {t:"Empiezo a hacer algo para avanzar.", v:"oso"},
         {t:"Ordeno la información para volverla clara.", v:"condor"} ]},
/*32 */ {q:"En una caminata, el grupo debe decidir por qué camino seguir.",
  opts:[ {t:"Verifico que todos estén tranquilos.", v:"buho"},
         {t:"Acompaño a quien tenga dudas.", v:"frailejon"},
         {t:"Camino primero para explorar.", v:"oso"},
         {t:"Analizo la ruta y propongo la mejor opción.", v:"condor"} ]},
/*33 */ {q:"En un ensayo de música o teatro, algo no está fluyendo.",
  opts:[ {t:"Pregunto cómo se sienten con la parte.", v:"buho"},
         {t:"Ayudo a practicar lo que falta.", v:"frailejon"},
         {t:"Actúo/ejecuto marcando un ritmo.", v:"oso"},
         {t:"Propongo ajustar la estructura.", v:"condor"} ]},
/*34 */ {q:"En un partido cerrado, quedan pocos minutos.",
  opts:[ {t:"Los motivo desde lo emocional.", v:"buho"},
         {t:"Hago la jugada que más beneficie al equipo.", v:"frailejon"},
         {t:"Tomo la iniciativa con energía.", v:"oso"},
         {t:"Propongo una jugada estratégica.", v:"condor"} ]},
/*35 */ {q:"En clase, deben resolver un caso complejo.",
  opts:[ {t:"Escucho a todos.", v:"buho"},
         {t:"Divido partes del análisis.", v:"frailejon"},
         {t:"Empiezo a resolver.", v:"oso"},
         {t:"Organizo el método.", v:"condor"} ]},
/*36 */ {q:"Hay tensión entre dos compañeros.",
  opts:[ {t:"Los escucho por separado.", v:"buho"},
         {t:"Intento mediar.", v:"frailejon"},
         {t:"Propongo salir a caminar para calmarse.", v:"oso"},
         {t:"Analizo qué generó el conflicto.", v:"condor"} ]},
/*37 */ {q:"Antes de una salida, deben empacar bien.",
  opts:[ {t:"Pregunto quién está nervioso.", v:"buho"},
         {t:"Reviso que todos tengan lo básico.", v:"frailejon"},
         {t:"Empaco rápido y ayudo.", v:"oso"},
         {t:"Creo un esquema de empaque.", v:"condor"} ]},
/*38 */ {q:"El profesor propone un debate.",
  opts:[ {t:"Me enfoco en cómo se sienten frente al tema.", v:"buho"},
         {t:"Ayudo a que todos participen.", v:"frailejon"},
         {t:"Hablo con fuerza al inicio.", v:"oso"},
         {t:"Estructuro mis ideas antes de hablar.", v:"condor"} ]},
/*39 */ {q:"En descanso, el grupo quiere planear algo para hacer.",
  opts:[ {t:"Pregunto qué les gustaría emocionalmente.", v:"buho"},
         {t:"Propongo algo que nos incluya a todos.", v:"frailejon"},
         {t:"Sugiero algo activo.", v:"oso"},
         {t:"Armo un mini plan con tiempos.", v:"condor"} ]},
/*40 */ {q:"En un proyecto largo, queda poco tiempo.",
  opts:[ {t:"Verifico que nadie esté colapsando.", v:"buho"},
         {t:"Hago lo que queda para aliviar al grupo.", v:"frailejon"},
         {t:"Trabajo rápido para avanzar.", v:"oso"},
         {t:"Ordeno prioridades para terminar.", v:"condor"} ]},
]; // end QUESTIONS

/* =========================
   LÓGICA: mezclar, paginar, respuestas
   ========================= */
let shuffledQs = QUESTIONS.slice().sort(()=> Math.random() - 0.5); // random order
const PAGE_SIZE = 10;
let currentPage = 0;
const totalPages = Math.ceil(shuffledQs.length / PAGE_SIZE);
const answers = {}; // key: global question index -> 'buho'|'frailejon'|'oso'|'condor'

const quizDiv = document.getElementById('quiz');
const progressBar = document.getElementById('progressBar');
const pageInfo = document.getElementById('pageInfo');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resultDiv = document.getElementById('result');

function escapeHtml(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

/* render single page of questions */
function renderPage(){
  quizDiv.innerHTML = "";
  const start = currentPage * PAGE_SIZE;
  const pageQs = shuffledQs.slice(start, start + PAGE_SIZE);

  pageQs.forEach((qItem, i) => {
    const globalIndex = start + i;
    const qBox = document.createElement('div');
    qBox.className = 'page active question';
    qBox.innerHTML = `<h4>${globalIndex+1}. ${escapeHtml(qItem.q)}</h4><div class="opts" id="opts_${globalIndex}"></div>`;
    quizDiv.appendChild(qBox);

    const optsDiv = document.getElementById(`opts_${globalIndex}`);
    // shuffle options too
    const optsShuffled = qItem.opts.slice().sort(()=> Math.random() - 0.5);
    optsShuffled.forEach((opt, oi) => {
      const id = `q_${globalIndex}_o_${oi}`;
      const pillClass = opt.v === 'buho' ? 'buho' : opt.v === 'frailejon' ? 'fraile' : opt.v === 'oso' ? 'oso' : 'condor';
      const pillLetter = opt.v === 'buho' ? 'A' : opt.v === 'frailejon' ? 'B' : opt.v === 'oso' ? 'C' : 'D';

      // create label with visible radio input (so user sees selection)
      const label = document.createElement('label');
      label.className = 'opt';
      label.htmlFor = id;

      label.innerHTML = `
        <div class="pill ${pillClass}">${pillLetter}</div>
        <div style="flex:1;display:flex;gap:10px;align-items:flex-start">
          <input type="radio" name="q_${globalIndex}" id="${id}" value="${opt.v}" />
          <div style="min-height:1.2em">${escapeHtml(opt.t)}</div>
        </div>
      `;

      // set initial checked state if already answered
      const radioInput = label.querySelector('input[type="radio"]');
      if(answers[globalIndex] === opt.v){
        radioInput.checked = true;
        label.classList.add('selected');
      }

      // when clicking label or input -> set answer, mark selected
      const setAnswer = () => {
        answers[globalIndex] = opt.v;
        // unselect sibling labels in this optsDiv
        const siblings = optsDiv.querySelectorAll('label.opt');
        siblings.forEach(s => s.classList.remove('selected'));
        label.classList.add('selected');
        // ensure actual radio checked
        const r = label.querySelector('input[type="radio"]');
        if(r) r.checked = true;
        updateProgress();
      };

      // input change event
      radioInput.addEventListener('change', setAnswer);
      // label click (covers clicking outer area)
      label.addEventListener('click', (e) => {
        // if click came from input it's already handled; still call setAnswer
        setAnswer();
      });

      optsDiv.appendChild(label);
    });
  });

  // update nav
  prevBtn.disabled = currentPage === 0;
  nextBtn.textContent = currentPage === totalPages - 1 ? 'Finalizar' : 'Siguiente';
  updateProgress();
  pageInfo.textContent = `Página ${currentPage+1} / ${totalPages} · Respondidas ${Object.keys(answers).length} / ${shuffledQs.length}`;
}

/* update progress UI */
function updateProgress(){
  const done = Object.keys(answers).length;
  const pct = Math.round((done / shuffledQs.length) * 100);
  progressBar.style.width = pct + '%';
  pageInfo.textContent = `Página ${currentPage+1} / ${totalPages} · Respondidas ${done} / ${shuffledQs.length}`;
}

/* navigation */
function nextPage(){
  // validate current page all answered
  const start = currentPage * PAGE_SIZE;
  const end = Math.min(start + PAGE_SIZE, shuffledQs.length);
  for(let i=start;i<end;i++){
    if(!answers.hasOwnProperty(i)){
      alert('Por favor responde todas las preguntas de la página antes de continuar. Falta la pregunta ' + (i+1));
      document.getElementById(`opts_${i}`).scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }
  }

  if(currentPage < totalPages - 1){
    currentPage++;
    renderPage();
    window.scrollTo({top:0,behavior:'smooth'});
  } else {
    computeResults();
  }
}

function prevPage(){
  if(currentPage>0){ currentPage--; renderPage(); window.scrollTo({top:0,behavior:'smooth'}); }
}

/* compute results & render final screen (same page) */
function computeResults(){
  // tally
  const counts = { buho:0, frailejon:0, oso:0, condor:0 };
  for(let i=0;i<shuffledQs.length;i++){
    const v = answers[i];
    if(v && counts.hasOwnProperty(v)) counts[v]++;
  }
  const total = counts.buho + counts.frailejon + counts.oso + counts.condor || 1;
  const percent = {
    buho: Math.round(counts.buho / total * 100),
    frailejon: Math.round(counts.frailejon / total * 100),
    oso: Math.round(counts.oso / total * 100),
    condor: Math.round(counts.condor / total * 100)
  };
  // dominant
  const ordered = Object.entries(percent).sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0]));
  const dominantKey = ordered[0][0];

  // hide quiz
  document.querySelector('.progress').style.display = 'none';
  document.querySelector('.nav').style.display = 'none';
  quizDiv.style.display = 'none';

  // prepare profile content
  const profiles = {
    buho: {
      title: 'BÚHO — Lidera desde la empatía',
      color: 'var(--accent)',
      badgeColor: '#2f6b3a',
      desc: 'Lideras poniendo atención al clima emocional y a la inclusión. Generas espacios donde las personas se sienten escuchadas y cuidadas.',
      characteristics: ['Escucha activa','Sensibilidad emocional','Capacidad para mediar'],
      motivates: ['Apoyar a otros','Mantener la armonía','Que todos participen'],
      values: ['Empatía','Respeto','Cuidado mutuo'],
      communication: 'Prefieres conversaciones cara a cara y tiempos de escucha. Respondes bien a preguntas abiertas.',
      shadows: ['Evitar confrontaciones necesarias','Sobrecarga emocional','Dificultad para decisiones impopulares'],
      dofa: {
        F:['Conexión interpersonal','Habilidad de contención','Promueve cohesión'],
        O:['Formación en límites y asertividad','Rol de facilitador escolar'],
        D:['Sobrecarga emocional','Priorizar relaciones sobre resultados'],
        A:['Burnout emocional','Ser percibido como poco firme']
      },
      recs: ['Practica decir "no" cuando haga falta','Alíate con perfiles decisores','Reserva tiempo para recuperarte']
    },
    frailejon: {
      title: 'FRAILEJÓN — Lidera desde el servicio',
      color: 'var(--fraile)',
      badgeColor: '#b07f2d',
      desc: 'Sostienes la operación con acciones concretas. Te preocupas porque todo funcione y porque nadie quede atrás.',
      characteristics: ['Disponibilidad','Constancia','Fiabilidad operativa'],
      motivates: ['Ver al equipo avanzar','Apoyar a quienes lo necesitan','Contribuir al bien común'],
      values: ['Servicio','Responsabilidad','Humildad'],
      communication: 'Mensajes prácticos y orientados a la ayuda. Aprecias reconocimiento por tu aporte.',
      shadows: ['Asumir demasiadas tareas','Dificultad para pedir apoyo'],
      dofa: {
        F:['Sostén operativo','Alta disponibilidad','Consistencia'],
        O:['Visibilizar aportes','Delegar mejor'],
        D:['Riesgo de agotamiento','Menos búsqueda de reconocimiento'],
        A:['Ser pasado por alto','Agotamiento físico/emocional']
      },
      recs: ['Establece límites y prioridades','Pide reconocimiento cuando haga falta','Practica delegar']
    },
    oso: {
      title: 'OSO ANDINO — Lidera desde la acción',
      color: 'var(--oso)',
      badgeColor: '#6d4b32',
      desc: 'Actúas con iniciativa: arrancas, ejecutas y movilizas al equipo para que avance y consiga resultados visibles.',
      characteristics: ['Iniciativa','Energía','Resiliencia práctica'],
      motivates: ['Retos reales','Resultados visibles','Superar obstáculos'],
      values: ['Acción','Disciplina','Compromiso'],
      communication: 'Directo y concreto; valoras instrucciones claras y feedback inmediato.',
      shadows: ['Impulsividad','Impaciencia','Tendencia a cargar demasiado'],
      dofa: {
        F:['Alta ejecución','Ejemplo movilizador','Resiliencia'],
        O:['Formación en planificación','Alianzas con analíticos'],
        D:['Impulsividad','Poca visión a largo plazo'],
        A:['Desgaste físico/mental','Conflictos por estilo directo']
      },
      recs: ['Toma micro-pausas para reflexionar','Alíate con perfiles estructurados','Comunica el porqué']
    },
    condor: {
      title: 'CÓNDOR — Lidera desde la razón y la estrategia',
      color: 'var(--condor)',
      badgeColor: '#254f8a',
      desc: 'Aportas estructura, análisis y claridad. Te encargas de organizar, planificar y justificar decisiones con criterios claros.',
      characteristics: ['Pensamiento analítico','Organización','Toma de decisiones fundamentada'],
      motivates: ['Resolver problemas complejos','Optimizar procesos','Trabajar con evidencia'],
      values: ['Claridad','Precisión','Eficiencia'],
      communication: 'Estructurada y lógica; valoras datos y pasos claros.',
      shadows: ['Distanciamiento emocional','Exceso de análisis'],
      dofa: {
        F:['Capacidad analítica','Organización','Visión estratégica'],
        O:['Desarrollar empatía comunicativa','Métodos ágiles para evitar parálisis'],
        D:['Rigidez','Dificultad para gestionar incertidumbre'],
        A:['Percepción de frialdad','Resistencia en equipos menos estructurados']
      },
      recs: ['Sintetiza ideas en 1–2 frases','Valida emociones antes de presentar datos','Usa prototipos para evitar parálisis']
    }
  };

  // render result container
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = `
    <div class="grid2" id="resultGrid" style="align-items:start">
      <div class="profileCard" id="leftCard">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div style="font-size:13px;color:var(--muted)">Resultados</div>
            <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
              <div style="padding:10px;border-radius:12px;background:rgba(138,166,138,0.08)"><strong>Búho</strong><div style="font-size:20px;color:var(--accent)">${percent.buho}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(217,191,87,0.06)"><strong>Frailejón</strong><div style="font-size:20px;color:var(--fraile)">${percent.frailejon}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(139,106,74,0.06)"><strong>Oso</strong><div style="font-size:20px;color:var(--oso)">${percent.oso}%</div></div>
              <div style="padding:10px;border-radius:12px;background:rgba(74,111,177,0.06)"><strong>Cóndor</strong><div style="font-size:20px;color:var(--condor)">${percent.condor}%</div></div>
            </div>
          </div>
          <div style="min-width:210px;text-align:right">
            <div class="dominantTitle" id="dominantBig">${profiles[dominantKey].title.split('—')[0].trim()}</div>
            <div class="dominantSubtitle">${profiles[dominantKey].title.split('—')[1].trim()}</div>
            <div><span class="dominantBadge" id="dominantBadge" style="background:${profiles[dominantKey].badgeColor};font-size:15px">${profiles[dominantKey].title.split('—')[1].trim()}</span></div>
          </div>
        </div>

        <div style="margin-top:12px;background:linear-gradient(180deg,#fff,#fbfbfb);padding:12px;border-radius:10px;border:1px solid var(--line)">
          <canvas id="radarChart" style="max-height:360px;"></canvas>
        </div>

        <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap">
          <button class="primary" id="downloadPdfBtn">Descargar PDF (completo)</button>
          <button class="ghost" id="restartBtn">Reiniciar test</button>
        </div>
      </div>

      <div class="profileCard" id="profileLong">
        <!-- perfil largo será insertado aquí -->
      </div>
    </div>
  `;

  // fill full profile on right card
  const p = profiles[dominantKey];
  const profileLong = document.getElementById('profileLong');
  profileLong.innerHTML = `
    <h3 style="margin:0 0 6px">${p.title}</h3>
    <p style="margin:0 0 12px;color:var(--muted)"><em>${p.desc}</em></p>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div>
        <strong>Características</strong>
        <ul>${p.characteristics.map(x=>`<li>${x}</li>`).join('')}</ul>
        <strong>Motivaciones</strong>
        <ul>${p.motivates.map(x=>`<li>${x}</li>`).join('')}</ul>
      </div>
      <div>
        <strong>Qué valoras en tu equipo</strong>
        <ul>${p.values.map(x=>`<li>${x}</li>`).join('')}</ul>
        <strong>Cómo comunicarse contigo</strong>
        <p style="margin:6px 0 0">${p.communication}</p>
      </div>
    </div>

    <div style="margin-top:12px">
      <strong>Sombras</strong>
      <p style="margin:6px 0 10px">${p.shadows.join('; ')}</p>

      <h4 style="margin-top:6px">DOFA</h4>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Fortalezas</strong><ul>${p.dofa.F.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Oportunidades</strong><ul>${p.dofa.O.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Debilidades</strong><ul>${p.dofa.D.map(i=>`<li>${i}</li>`).join('')}</ul></div>
        <div style="background:#fbfbfb;padding:8px;border-radius:8px"><strong>Amenazas</strong><ul>${p.dofa.A.map(i=>`<li>${i}</li>`).join('')}</ul></div>
      </div>

      <strong style="display:block;margin-top:12px">Recomendaciones prácticas</strong>
      <ul>${p.recs.map(i=>`<li>${i}</li>`).join('')}</ul>
    </div>
  `;

  // chart
  const ctx = document.getElementById('radarChart').getContext('2d');
  const bg = dominantKey === 'buho' ? 'rgba(138,166,138,0.16)' :
             dominantKey === 'frailejon' ? 'rgba(217,191,87,0.14)' :
             dominantKey === 'oso' ? 'rgba(139,106,74,0.12)' :
             'rgba(74,111,177,0.12)';

  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Búho','Frailejón','Oso Andino','Cóndor'],
      datasets: [{
        label: 'Porcentaje',
        data: [percent.buho, percent.frailejon, percent.oso, percent.condor],
        fill: true,
        backgroundColor: bg,
        borderColor: (dominantKey==='buho'? '#8aa68a' : dominantKey==='frailejon'? '#d9bf57' : dominantKey==='oso'? '#8b6a4a' : '#4a6fb1'),
        pointBackgroundColor:['#8aa68a','#d9bf57','#8b6a4a','#4a6fb1'],
        pointBorderColor:'#fff',
        pointHoverBorderColor:'#000'
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero:true,
          suggestedMax:100,
          ticks:{stepSize:20, color: '#4b5563'},
          grid: { color: '#ecf0ef' },
          angleLines: { color: '#ecf0ef' },
          pointLabels: { color: '#4b5563' }
        }
      },
      plugins:{legend:{display:false}},
      elements: { line: { borderWidth: 2 } }
    }
  });

  /* ===== PDF: SINGLE LONG PAGE (opción A) =====
     Renderizamos área de resultados a canvas y creamos un PDF con el alto exacto
  */
  document.getElementById('downloadPdfBtn').addEventListener('click', async ()=> {
    const target = document.getElementById('resultGrid');
    if(!target) return alert('No hay resultados para exportar');

    // clone and prepare (ensure width consistent)
    const clone = target.cloneNode(true);
    const wrapper = document.createElement('div');
    wrapper.style.width = '900px';
    wrapper.style.padding = '24px';
    wrapper.style.background = '#fff';
    wrapper.style.boxSizing = 'border-box';
    wrapper.appendChild(clone);
    document.body.appendChild(wrapper);

    // replace canvas with image in clone (chart)
    try {
      const origCanvas = document.querySelector('#radarChart');
      if(origCanvas){
        const dataUrl = origCanvas.toDataURL('image/png');
        const clonedCanvas = clone.querySelector('canvas');
        if(clonedCanvas && clonedCanvas.parentNode){
          const img = document.createElement('img');
          img.src = dataUrl;
          img.style.width = '100%';
          img.style.height = 'auto';
          clonedCanvas.parentNode.replaceChild(img, clonedCanvas);
        }
      }
    } catch(e){ /* ignore */ }

    // render wrapper to canvas
    const scale = 2; // improve quality
    const canvasRender = await html2canvas(wrapper, {scale: scale, useCORS:true, backgroundColor: '#ffffff'});
    wrapper.remove();

    // create pdf with exact pixel dimensions (unit: px)
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({orientation:'portrait', unit:'px', format:[canvasRender.width, canvasRender.height]});
    const imgData = canvasRender.toDataURL('image/png');
    pdf.addImage(imgData, 'PNG', 0, 0, canvasRender.width, canvasRender.height);
    const filename = `Resultados_Arquetipo_${(new Date()).toISOString().slice(0,19).replace(/[:T]/g,'_')}.pdf`;
    pdf.save(filename);
  });

  // restart
  document.getElementById('restartBtn').addEventListener('click', ()=> location.reload());
} // end computeResults

// initial render
renderPage();
updateProgress();

</script>
</body>
</html>
